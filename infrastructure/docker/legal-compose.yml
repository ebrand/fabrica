# Fabrica Commerce Cloud - Legal Domain Services
# Handles compliance, legal documents, and regulatory requirements

services:
  # Legal Domain Database Initializer
  legal-db-init:
    image: postgres:16-alpine
    container_name: legal-db-init
    environment:
      PGHOST: postgres
      PGPORT: 5432
      PGUSER: ${POSTGRES_USER:-fabrica_admin}
      PGPASSWORD: ${POSTGRES_PASSWORD:-fabrica_dev_password}
    networks:
      - fabrica-network
    depends_on:
      postgres:
        condition: service_healthy
    entrypoint: >
      sh -c "
        echo 'Initializing Legal domain database...' &&
        psql -c 'CREATE DATABASE \"fabrica-legal-db\";' || echo 'Database already exists' &&
        psql -d fabrica-legal-db -c 'CREATE SCHEMA IF NOT EXISTS fabrica;' &&
        psql -d fabrica-legal-db -c 'CREATE SCHEMA IF NOT EXISTS cdc;' &&
        echo 'Legal database initialized successfully'
      "
    restart: "no"

  # Placeholder for Legal Domain Service (ACL)
  # Uncomment and configure when ready to implement
  # acl-legal:
  #   build:
  #     context: ../../domain/legal/acl/LegalDomainService
  #     dockerfile: Dockerfile
  #   container_name: acl-legal
  #   environment:
  #     - NODE_ENV=${NODE_ENV:-development}
  #     - PORT=3470
  #     - DATABASE_URL=postgresql://${POSTGRES_USER:-fabrica_admin}:${POSTGRES_PASSWORD:-fabrica_dev_password}@postgres:5432/fabrica-legal-db
  #   ports:
  #     - "3470:3470"
  #   networks:
  #     - fabrica-network
  #   depends_on:
  #     legal-db-init:
  #       condition: service_completed_successfully
  #   restart: unless-stopped

# Network is inherited from the master fabrica-compose.yml file
